
---

### CBC Bit-Flipping Attack

This script performs a bit-flipping attack on a given encrypted cookie to extract the flag from the challenge server.

#### Code Breakdown

1. **Import Necessary Libraries**
```python
import requests
from base64 import b64decode, b64encode
from tqdm import tqdm
```
- `requests` allows the script to make HTTP requests.
- Functions from `base64` are used to encode and decode Base64 strings.
- `tqdm` provides a progress bar, helping the user to understand how far along the attack is.

2. **Bit-Flipping Function**
```python
def bit_flip(pos, bit, data):
    raw = b64decode(b64decode(data))
    list1 = bytearray(raw)
    list1[pos] = list1[pos] ^ (1 << bit)  # Flipping the appropriate bit using a mask
    raw = bytes(list1)
    return b64encode(b64encode(raw)).decode()
```
- This function flips a specific bit in the doubly Base64-decoded cookie.
- It first decodes the data twice to get to the raw encrypted form.
- It then flips a particular bit using XOR.
- Finally, it encodes the data back twice in Base64 and returns it.

3. **Target Cookie**
```python
cookie = "dnRqL1ZPQWJwajJRcDJv..."
```
- This is the encrypted cookie we aim to attack.

4. **Bruteforce Attack**
```python
for position_idx in tqdm(range(len(b64decode(b64decode(cookie)))), desc="Bruteforcing Position"):
    for bit_idx in tqdm(range(8), desc="Bruteforcing Bit"):
        auth_cookie = bit_flip(position_idx, bit_idx, cookie)
        cookies = {'auth_name': auth_cookie}
        r = requests.get('http://mercury.picoctf.net:34962/', cookies=cookies)
        if "picoCTF{" in r.text:
            print("Flag: " + r.text.split("<code>")[1].split("</code>")[0])
            exit()
```
- The script attempts to flip each bit of each byte in the decoded cookie.
- For every modified cookie, it sends a request to the target server.
- If the server responds with text containing "picoCTF{", it is assumed that the valid flag is found, and it is then extracted and displayed.
- The script will exit upon finding the flag.

---

### Usage

To use this script, ensure you have the necessary Python libraries installed:

```bash
pip install requests tqdm
```

Then, simply run the script:

```bash
python script.py
```

Replace `script.py` with the actual name of the script.